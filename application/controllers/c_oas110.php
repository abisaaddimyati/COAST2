<?php /************************************************************************************************ * Program History :** Project Name     : OAS* Client Name      : CBI - Muhammad* Program Id       : OAS110* Program Name     : Upload Document* Description      :* Environment      : PHP 5.4.4* Author           : Winni Oktaviani* Version          : 01.00.00* Creation Date    : 15-09-2015 00:02:00 ** Update history     Re-fix date       Person in charge      Description* * ** Copyright(C) [..]. All Rights Reserved*************************************************************************************************/if ( ! defined('BASEPATH')) exit('No direct script access allowed');class C_OAS110 extends MY_Controller {	function __construct()	{		parent::__construct();		$index	= $this->config->item('index_page');		$host	= $this->config->item('base_url');		$this->url = empty($index) ? $host : $host . $index . '/';		$this->load->model('m_oas110','m110');	}	function load_view()	{		$param['this_id']	= $this->user['id']; 		$param['this_email']		= $this->user['email'];			$param['this_name'] 		= $this->user['name'];				$DelDOC= $this->m110->delDOC_ID($param['this_id']);		echo $DelDOC;		$response = $this->m110->insertDOC_ID($param);		$param['idDOC'] = $this->m110->getDOC_ID($param['this_id']);         echo $response;				$this->load->view('v_oas110', $param);	}			function do_upload(){		if(isset($_FILES["FileInput110"]) && $_FILES["FileInput110"]["error"]== UPLOAD_ERR_OK)	{		############ Edit settings ##############		$UploadDirectory	= './assets/document/'; //specify upload directory ends with / (slash)		##########################################				/*		Note : You will run into errors or blank page if "memory_limit" or "upload_max_filesize" is set to low in "php.ini". 		Open "php.ini" file, and search for "memory_limit" or "upload_max_filesize" limit 		and set them adequately, also check "post_max_size".		*/				//check if this is an ajax request		if (!isset($_SERVER['HTTP_X_REQUESTED_WITH'])){			die();		}						//Is file size is less than allowed size.		if ($_FILES["FileInput110"]["size"] > 5242880) {			die("File size is too big!");		}				//allowed file type Server side check		switch(strtolower($_FILES['FileInput110']['type']))		{				//allowed file types				case 'image/png': 				case 'image/gif': 				case 'image/jpeg': 				case 'image/pjpeg':				case 'text/plain':				case 'text/html': //html file				case 'application/x-zip-compressed':				case 'application/pdf':				case 'application/msword':				case 'application/vnd.ms-excel':				case 'video/mp4':					break;				default:					die('Unsupported File!'); //output110 error		}				$File_Name          = strtolower($_FILES['FileInput110']['name']);		$File_Ext           = substr($File_Name, strrpos($File_Name, '.')); //get file extention		$Random_Number      = rand(0, 9999999999); //Random number to be added to name.		$NewFileName 		= $Random_Number.$File_Ext; //new file name				$empid=$_POST['empid'];		$docid=$_POST['hd_DOC_ID'];				if(move_uploaded_file($_FILES['FileInput110']['tmp_name'], $UploadDirectory.$File_Name ))		   {		   $filedok ="/assets/document/".$File_Name;			 $this->db->query("UPDATE tb_m_document SET DOCUMENT_LOCATION = '$filedok',								DOCUMENT_NAME = '$File_Name',								CREATED_BY = '$empid',								CREATED_DT =  '".gmdate("Y-m-d H:i:s", time()+60*60*7)."',								DOCUMENT_STATUS = '2'							WHERE 								DOCUMENT_ID ='$docid'");			die('Success! File Uploaded.'.$File_Name );					}else{			die('error uploading File!');		}			}	else	{		die('Something wrong with upload! Is "upload_max_filesize" set correctly?');	}}function submit_doc()	{			$sbmt['DOCUMENT_ID']  	= $this->input->post('doc_id');			$sbmt['DESCRIPTION'] 	= $this->input->post('description');            $response = $this->m110->updateDocDesctiption($sbmt);            echo $response;			}	}